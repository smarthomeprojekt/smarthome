attr global userattr cmdIcon devStateIcon:textField-long devStateStyle icon sortby webCmd webCmdLabel:textField-long widgetOverride
attr global autoload_undefined_devices 1
attr global autosave 0
attr global commandref modular
attr global dnsServer 127.0.0.11
attr global latitude 48.773251
attr global logfile ./log/fhem-%Y-%m-%d.log
attr global longitude 9.171027
attr global modpath .
attr global mseclog 1
attr global nofork 0
attr global pidfilename ./log/fhem.pid
attr global statefile ./log/fhem.save
attr global updateInBackground 1
attr global verbose 3

define WEB FHEMWEB 8083 global
setuuid WEB 61a930ec-f33f-d890-d852-79453e72c6fe8e1b
attr WEB longpoll websocket

# Fake FileLog entry, to access the fhem log from FHEMWEB 
define Logfile FileLog ./log/fhem-%Y-%m-%d.log fakelog
setuuid Logfile 61a930ef-f33f-d890-9613-fc89986075f59d07

define autocreate autocreate
setuuid autocreate 61a930ef-f33f-d890-055f-3f8c87902d0503af
attr autocreate filelog ./log/%NAME-%Y.log

define eventTypes eventTypes ./log/eventTypes.txt
setuuid eventTypes 61a930ef-f33f-d890-6ddd-849df290a157ea77

# Disable this to avoid looking for new USB devices on startup
define initialUsbCheck notify global:INITIALIZED usb create
setuuid initialUsbCheck 61a930ef-f33f-d890-75d8-7df14b1207e00165
define DockerImageInfo DockerImageInfo
setuuid DockerImageInfo 61a930ef-f33f-d890-8796-221b67b9162561ac
attr DockerImageInfo alias Docker Image Info
attr DockerImageInfo devStateIcon ok:security@green Initialized:system_fhem_reboot@orange .*:message_attention@red
attr DockerImageInfo group System
attr DockerImageInfo icon docker
attr DockerImageInfo room System
define fhemServerApt AptToDate localhost
setuuid fhemServerApt 61a930ef-f33f-d890-87f0-8e76371140846ce7
attr fhemServerApt alias System Update Status
attr fhemServerApt devStateIcon system.updates.available:security@red system.is.up.to.date:security@green:repoSync .*in.progress:system_fhem_reboot@orange errors:message_attention@red
attr fhemServerApt group Update
attr fhemServerApt icon debian
attr fhemServerApt room System
define fhemServerNpm npmjs localhost
setuuid fhemServerNpm 61a930ef-f33f-d890-a4bb-292dbecd8c0b4306
attr fhemServerNpm alias Node.js Package Update Status
attr fhemServerNpm devStateIcon npm.updates.available:security@red:outdated npm.is.up.to.date:security@green:outdated .*npm.outdated.*in.progress:system_fhem_reboot@orange .*in.progress:system_fhem_update@orange warning.*:message_attention@orange error.*:message_attention@red
attr fhemServerNpm group Update
attr fhemServerNpm icon npm-old
attr fhemServerNpm room System
define fhemInstaller Installer
setuuid fhemInstaller 61a930f0-f33f-d890-1f8d-2c75471ea448c804
attr fhemInstaller alias FHEM Installer Status
attr fhemInstaller devStateIcon .*updates.available:security@red:outdated up.to.date:security@green:outdated .*outdated.*in.progress:system_fhem_reboot@orange .*in.progress:system_fhem_update@orange warning.*:message_attention@orange error.*:message_attention@red
attr fhemInstaller group Update
attr fhemInstaller icon system_fhem
attr fhemInstaller room System
define telnetPort telnet 7072
setuuid telnetPort 61a930f0-f33f-d890-4055-96a01407f47a3ad1

#######################################################################
#####                         Frontend UI                         #####
#######################################################################
define TABLETUI HTTPSRV ftui/ ./www/tablet/ Tablet-UI
setuuid TABLETUI 61af60b0-f33f-ff80-f5e1-9c08ee48c4a0759b

#######################################################################
#####        START         Weihnachtsbeleuchtung        START     #####
#######################################################################
# Funkempfänger definieren
define CULSender CUL /dev/ttyUSB0@38400 0000
setuuid CULSender 61ae04a0-f33f-b0ea-593f-bfb5f469b3aad07b
# MQTT Server/Broker definieren
define MQTT_Server MQTT2_SERVER 1883 global
setuuid MQTT_Server 61b5d1e4-f33f-ff84-0bcd-f2a029c512891efc
attr MQTT_Server room MQTT Broker
# WLAN Steckdose definieren
define SteckdoseWLAN MQTT2_DEVICE DVES_BB61B2
setuuid SteckdoseWLAN 61b5d233-f33f-ff84-e109-76748c369538a250
attr SteckdoseWLAN IODev MQTT_Server
attr SteckdoseWLAN autocreate 0
attr SteckdoseWLAN icon hue_filled_outlet
attr SteckdoseWLAN jsonMap POWER1:0 POWER2:0 POWER3:0 POWER4:0 Dimmer:0 Channel_0:0 Channel_1:0 Channel_2:0 Channel_3:0 Channel_4:0 HSBColor:0 Color:0
attr SteckdoseWLAN model tasmota_basic_state_power1
attr SteckdoseWLAN readingList tele/tasmota_BB61B2/LWT:.* LWT\
  tele/tasmota_BB61B2/STATE:.* { json2nameValue($EVENT,'',$JSONMAP) }\
  tele/tasmota_BB61B2/SENSOR:.* { json2nameValue($EVENT,'',$JSONMAP) }\
  tele/tasmota_BB61B2/INFO.:.* { json2nameValue($EVENT,'',$JSONMAP) }\
  tele/tasmota_BB61B2/UPTIME:.* { json2nameValue($EVENT,'',$JSONMAP) }\
  stat/tasmota_BB61B2/POWER1:.* state\
  stat/tasmota_BB61B2/RESULT:.* { json2nameValue($EVENT,'',$JSONMAP) }
attr SteckdoseWLAN room MQTT Geräte,Wohnzimmer
attr SteckdoseWLAN setList off:noArg    cmnd/tasmota_BB61B2/POWER1 0\
  on:noArg     cmnd/tasmota_BB61B2/POWER1 1\
  toggle:noArg cmnd/tasmota_BB61B2/POWER1 2\
  setOtaUrl:textField cmnd/tasmota_BB61B2/OtaUrl $EVTPART1\
  upgrade:noArg   cmnd/tasmota_BB61B2/upgrade 1
attr SteckdoseWLAN setStateList on off toggle
define FileLog_SteckdoseWLAN FileLog ./log/SteckdoseWLAN-%Y.log SteckdoseWLAN
setuuid FileLog_SteckdoseWLAN 61b5d233-f33f-ff84-8b3c-41fdbc3b4b814de8
attr FileLog_SteckdoseWLAN logtype text
attr FileLog_SteckdoseWLAN room MQTT Geräte
# Funksteckdose definieren
define Steckdose433 IT 0FFF0FFF0F FF F0
setuuid Steckdose433 61ae3eec-f33f-b0ea-2447-a3fc75fb5f7b732d
attr Steckdose433 IODev CULSender
attr Steckdose433 icon hue_filled_outlet
attr Steckdose433 model itswitch
attr Steckdose433 room 433MHz Geräte,Wohnzimmer

# Modus A
define A_FesteZeit433 at *17:00:00 set Steckdose433 on-till-overnight 07:00:00
setuuid A_FesteZeit433 61b0794f-f33f-31a0-c2c0-d1a9a4b7df3c02d2
attr A_FesteZeit433 room Wohnzimmer
define A_FesteZeitWLAN at *18:00:00 set SteckdoseWLAN on-till-overnight 08:00:00
setuuid A_FesteZeitWLAN 61b07c43-f33f-31a0-b636-10bb08542af1e9f2
attr A_FesteZeitWLAN room Wohnzimmer
# Modus B
define B_Sonne433sunset at *{sunset()} set Steckdose433 on
setuuid B_Sonne433sunset 61bc5b5d-f33f-31a0-e101-03e672c5adbe076e
attr B_Sonne433sunset userattr structexclude sunrise sunrise_map
attr B_Sonne433sunset room Wohnzimmer
define B_Sonne433sunrise at *{sunrise()} set Steckdose433 off
setuuid B_Sonne433sunrise 61bc5bc7-f33f-31a0-dee0-4436d1c4f1902b2a
attr B_Sonne433sunrise userattr structexclude sunrise sunrise_map
attr B_Sonne433sunrise room Wohnzimmer
define B_SonneWLANsunrise at *{sunrise()} set SteckdoseWLAN off
setuuid B_SonneWLANsunrise 61bc5c72-f33f-31a0-f324-9f2c617a59eeca3a
attr B_SonneWLANsunrise userattr structexclude sunrise sunrise_map
attr B_SonneWLANsunrise room Wohnzimmer
define B_SonneWLANsunset at *{sunset()} set SteckdoseWLAN on
setuuid B_SonneWLANsunset 61bc5cb8-f33f-31a0-9917-3881ef36be3c2046
attr B_SonneWLANsunset userattr structexclude sunrise sunrise_map
attr B_SonneWLANsunset room Wohnzimmer
# Modus C
define C_SonneZeit433sunrise at *{sunrise(0,0,'7:30')} if(!($we)) set Steckdose433 off
setuuid C_SonneZeit433sunrise 61c04e40-f33f-31a0-576f-7d657b5e1ae4918b
attr C_SonneZeit433sunrise userattr structexclude sunriseZeit sunriseZeit_map
attr C_SonneZeit433sunrise room Wohnzimmer
define C_SonneZeitWLANsunrise at *{sunrise(0,0,'7:30')} if(!($we)) set SteckdoseWLAN off
setuuid C_SonneZeitWLANsunrise 61c04eab-f33f-31a0-926f-d12bbd84de02e93f
attr C_SonneZeitWLANsunrise userattr structexclude sunriseZeit sunriseZeit_map
attr C_SonneZeitWLANsunrise room Wohnzimmer
define C_SonneZeit433sunset at *{sunset()} set Steckdose433 on
setuuid C_SonneZeit433sunset 61bc6316-f33f-31a0-ce85-90d6175c6a157c0e
attr C_SonneZeit433sunset userattr structexclude sunriseZeit sunriseZeit_map
attr C_SonneZeit433sunset room Wohnzimmer
define C_SonneZeitWLANsunset at *{sunset()} set Steckdose433 on
setuuid C_SonneZeitWLANsunset 61bc6386-f33f-31a0-efb7-eaecc2cf76b69bdd
attr C_SonneZeitWLANsunset userattr structexclude sunriseZeit sunriseZeit_map
attr C_SonneZeitWLANsunset room Wohnzimmer
# Mdous c und d zu Structure hinzufügen
define B_Sonne433 structure sunrise B_Sonne433sunrise B_Sonne433sunset
setuuid B_Sonne433 61d553b9-f33f-31a0-b484-115d55ed1a273ec0
attr B_Sonne433 room Wohnzimmer
define B_SonneWLAN structure sunrise B_SonneWLANsunrise B_SonneWLANsunset
setuuid B_SonneWLAN 61d5545f-f33f-31a0-0642-c23c157770c2024d
attr B_SonneWLAN room Wohnzimmer
define C_SonneZeit433 structure sunriseZeit C_SonneZeit433sunrise C_SonneZeit433sunset
setuuid C_SonneZeit433 61d554c8-f33f-31a0-e788-4ee82c12344b66dc
attr C_SonneZeit433 room Wohnzimmer
define C_SonneZeitWLAN structure sunriseZeit C_SonneZeitWLANsunrise C_SonneZeitWLANsunset
setuuid C_SonneZeitWLAN 61d55548-f33f-31a0-67f6-47c1a9c57c78c270
attr C_SonneZeitWLAN room Wohnzimmer
# Modus D
# Geräte definieren
define MoritzHandy PRESENCE lan-ping 192.168.178.21
setuuid MoritzHandy 61b8a2d2-f33f-31a0-71f3-b6ace2f1f9ff3265
attr MoritzHandy userattr presence presence_map structexclude
attr MoritzHandy room Handys
define PaulHandy PRESENCE lan-ping 88.152.185.11
setuuid PaulHandy 61b8a2ec-f33f-31a0-4f85-6e5fb43978c5d5a0
attr PaulHandy userattr presence presence_map structexclude
attr PaulHandy room Handys
define LaraHandy PRESENCE lan-ping 80.187.96.47
setuuid LaraHandy 61c04c39-f33f-31a0-1b39-aeedaa0e65275e21
attr LaraHandy userattr presence presence_map structexclude
attr LaraHandy room Handys
define NathalieHandy PRESENCE lan-ping 192.168.178.40
setuuid NathalieHandy 61c04cd5-f33f-31a0-40b7-84b10f471189938b
attr NathalieHandy userattr presence presence_map structexclude
attr NathalieHandy room Handys
# in Structure zusammenfassen, um bei Bedarf weitere Geräte hinzufügen zu können (Neue Geräte hinzufügen mit: "addstruct Handys <Gerätname>")
define Handys structure presence MoritzHandy PaulHandy LaraHandy NathalieHandy
setuuid Handys 61b8a32d-f33f-31a0-8805-b0767a3306505132
attr Handys clientstate_behavior relative
attr Handys clientstate_priority present absent
# Festlegen der Priorität des Status der Geräte. Wenn mindestens ein Gerät den Status “present” hat, soll dieser Status priorisiert angenommen werden, sodass die Lichterkette nicht ausgeschalten wird, auch wenn alle anderen Geräte “absent” sind
# Modus d implementieren
define D_Anwesenheitserkennung433 DOIF ([17:00-07:00|WD] and [Handys] eq "present")(set Steckdose433 on) DOELSE (set Steckdose433 off)
setuuid D_Anwesenheitserkennung433 61dbf51b-f33f-31a0-f200-d31fb945f5f9963f
attr D_Anwesenheitserkennung433 room Wohnzimmer
define D_AnwesenheitserkennungWLAN DOIF ([17:00-07:00|WD] and [Handys] eq "present")(set SteckdoseWLAN on) DOELSE (set SteckdoseWLAN off)
setuuid D_AnwesenheitserkennungWLAN 61dbf5a4-f33f-31a0-b7d1-4104c777af658ccc
attr D_AnwesenheitserkennungWLAN room Wohnzimmer

# Ausschalten der anderen Modi bei Aktivierung eines Modus
define A_433Notify notify A_FesteZeit433 IF ([A_FesteZeit433] ne "inactive") (set B_Sonne433 inactive,set C_SonneZeit433 inactive,set D_Anwesenheitserkennung433 disable)
setuuid A_433Notify 61dbf17d-f33f-31a0-1711-e2699d5a3bcca16a
attr A_433Notify room Wohnzimmer
define B_433Notify notify B_Sonne433 IF ([B_Sonne433] ne "inactive") (set A_FesteZeit433 inactive,set C_SonneZeit433 inactive,set D_Anwesenheitserkennung433 disable)
setuuid B_433Notify 61dbf22c-f33f-31a0-8c5a-ad1bdc9f41330227
attr B_433Notify room Wohnzimmer
define C_433Notify notify C_SonneZeit433 IF ([C_SonneZeit433] ne "inactive") (set A_FesteZeit433 inactive,set B_Sonne433 inactive,set D_Anwesenheitserkennung433 disable)
setuuid C_433Notify 61dbf291-f33f-31a0-1ed6-260b7e2824c1a593
attr C_433Notify room Wohnzimmer
define D_433Notify notify D_Anwesenheitserkennung433 IF ([D_Anwesenheitserkennung433] ne "disabled") (set A_FesteZeit433 inactive,set B_Sonne433 inactive,set C_SonneZeit433 inactive)
setuuid D_433Notify 61dbf61d-f33f-31a0-35da-3681ca69fc43b5cf
attr D_433Notify room Wohnzimmer
define A_WLANNotify notify A_FesteZeitWLAN IF ([A_FesteZeitWLAN] ne "inactive") (set B_SonneWLAN inactive,set C_SonneZeitWLAN inactive,set D_AnwesenheitserkennungWLAN disable)
setuuid A_WLANNotify 61dbf6b0-f33f-31a0-b709-40411b8b5d51e9b5
attr A_WLANNotify room Wohnzimmer
define B_WLANNotify notify B_SonneWLAN IF ([B_SonneWLAN] ne "inactive") (set A_FesteZeitWLAN inactive,set C_SonneZeitWLAN inactive,set D_AnwesenheitserkennungWLAN disable)
setuuid B_WLANNotify 61dbf7dc-f33f-31a0-1608-24bc753369b92ffe
attr B_WLANNotify room Wohnzimmer
define C_WLANNotify notify C_SonneZeitWLAN IF ([C_SonneZeitWLAN] ne "inactive") (set A_FesteZeitWLAN inactive,set B_SonneWLAN inactive,set D_AnwesenheitserkennungWLAN disable)
setuuid C_WLANNotify 61dbf828-f33f-31a0-4e28-c5a605203e72ca50
attr C_WLANNotify room Wohnzimmer
define D_WLANNotify notify D_AnwesenheitserkennungWLAN IF ([D_AnwesenheitserkennungWLAN] ne "disabled") (set A_FesteZeitWLAN inactive,set B_SonneWLAN inactive,set C_SonneZeitWLAN inactive)
setuuid D_WLANNotify 61dbf8b6-f33f-31a0-b7b0-2fe87952f1a59f63
attr D_WLANNotify room Wohnzimmer
#######################################################################
#####        ENDE          Weihnachtsbeleuchtung        ENDE      #####
#######################################################################

#######################################################################
#####         START             Sturmwarnung        START         #####
#######################################################################
# Windsensor Hochdorf mit ID: 0B1D2300E734
define WindsensorHochdorf HTTPMOD https://www.data199.com/api/pv1/device/lastmeasurement 30
setuuid WindsensorHochdorf 61d21215-f33f-26d3-6aae-51266845d134f98b
attr WindsensorHochdorf userattr requestData
attr WindsensorHochdorf extractAllJSON 1
attr WindsensorHochdorf requestData deviceids=0B1D2300E734
attr WindsensorHochdorf room Sturmwarnung
attr WindsensorHochdorf stateFormat Geschwindigkeit: wind_speed m/s <br> Böe: wind_gust m/s <br> Richtung: wind_direction ° <br> Messung: timestamp
attr WindsensorHochdorf userReadings wind_direction:devices_01_measurement_wd.* { ReadingsVal("WindsensorHochdorf","devices_01_measurement_wd",0) }, \
  wind_speed:devices_01_measurement_ws.* { ReadingsVal("WindsensorHochdorf","devices_01_measurement_ws",0) }, \
  wind_gust:devices_01_measurement_wg.* { ReadingsVal("WindsensorHochdorf","devices_01_measurement_wg",0) }, \
  timestamp:devices_01_measurement_ts.* { POSIX::strftime("%F %T", localtime(ReadingsVal("WindsensorHochdorf","devices_01_measurement_ts",0))) }

#Telegram-Bot in FHEM eingebunden und default Empfänger hinzugefügt
define notificationbot TelegramBot
setuuid notificationbot 61d86834-f33f-1ec3-ac50-4dd034d39ffd2c2e
attr notificationbot defaultPeer @FHEM_tester
attr notificationbot room Sturmwarnung

#DOF-Device für die Sturmwarnung definiert und mit Attributen befüllt
define Stormwarning DOIF if([status_storm:"on"]) (set notificationbot message @-635902618 es funktioniert) elsif (set notificationbot message @-635902618 es hat auch funktioniert)
setuuid Stormwarning 61d84d5d-f33f-1ec3-bea6-706351c13bcface9
attr Stormwarning readingList status_storm windspeed_storm gustspeed_storm notified_storm
attr Stormwarning room Sturmwarnung
attr Stormwarning setList status_storm:on,off windspeed_storm:textField gustspeed_storm:textField notified_storm:0,1,2,3
attr Stormwarning webCmd status_storm:windspeed_storm:gustspeed_storm:notified_storm
attr Stormwarning webCmdLabel Anzeige: : :Benachrichtigt

#Notify-Device in FHEM eingebunden zur Kontrolle der Wetterdaten und versenden der Push-Notifications
define StormNotify notify WindsensorHochdorf IF ([Stormwarning:status_storm] eq "on") (\
 IF ([Stormwarning:notified_storm] == 0) (\
  IF (([WindsensorHochdorf:wind_speed] > [Stormwarning:windspeed_storm]) || \
  ([WindsensorHochdorf:wind_gust] > [Stormwarning:gustspeed_storm])) (\
   IF (([WindsensorHochdorf:wind_speed] > [Stormwarning:windspeed_storm]) && \
   ([WindsensorHochdorf:wind_gust] > [Stormwarning:gustspeed_storm])) (set notificationbot message @-635902618 Achtung❗️Gegenwärtig ist mit starken Windböen und hohen Windgeschwindigkeiten zu rechnen💨🌬Sind Sonnenschirme und Markise geschlossen?☂️🏡, set Stormwarning notified_storm 1)\
   ELSE \
   (\
 IF (([WindsensorHochdorf:wind_speed] > [Stormwarning:windspeed_storm]) && \
   ([WindsensorHochdorf:wind_gust] < [Stormwarning:gustspeed_storm])) (set notificationbot message @-635902618 Achtung❗️Gegenwärtig ist mit hohen Windgeschwindigkeiten zu rechnen🌬Sind Sonnenschirme und Markise geschlossen?☂️🏡, set Stormwarning notified_storm 2) \
 ELSE (set notificationbot message @-635902618 Achtung❗️Gegenwärtig ist mit starken Windböen zu rechnen💨Sind Sonnenschirme und Markise geschlossen?☂️🏡, set Stormwarning notified_storm 3) \
   )\
  )\
 ) ELSE (\
  IF (([WindsensorHochdorf:wind_speed] < [Stormwarning:windspeed_storm]) && \
  ([WindsensorHochdorf:wind_gust] < [Stormwarning:gustspeed_storm]))  (set notificationbot message @-635902618 Die aktuelle Wetterlage hat sich wieder beruhigt 🌤, set Stormwarning notified_storm 0)\
 ELSE (\
  IF ([Stormwarning:notified_storm] == 1) (\
  IF (([WindsensorHochdorf:wind_speed] < [Stormwarning:windspeed_storm]) || \
  ([WindsensorHochdorf:wind_gust] < [Stormwarning:gustspeed_storm]))  (set notificationbot message @-635902618 Die aktuelle Wetterlage hat sich verändert 🔔, set Stormwarning notified_storm 0)\
) ELSE (\
 IF ([Stormwarning:notified_storm] == 2) ( \
 IF (([WindsensorHochdorf:wind_speed] < [Stormwarning:windspeed_storm]) || ([WindsensorHochdorf:wind_gust] > [Stormwarning:gustspeed_storm])) (set notificationbot message @-635902618 Die aktuelle Wetterlage hat sich verändert 🔔, set Stormwarning notified_storm 0)\
) ELSE (\
 IF (([WindsensorHochdorf:wind_gust] < [Stormwarning:gustspeed_storm]) || ([WindsensorHochdorf:wind_speed] > [Stormwarning:windspeed_storm])) (set notificationbot message @-635902618 Die aktuelle Wetterlage hat sich verändert 🔔, set Stormwarning notified_storm 0)\
)\
)\
)\
)\
)
setuuid StormNotify 61db4b31-f33f-1ec3-631f-1fd5402392d93c89
attr StormNotify room Sturmwarnung
#######################################################################
#####         ENDE              Sturmwarnung        ENDE          #####
#######################################################################

#######################################################################
#####         START         Balkonkraftwerk         START         #####
#######################################################################
# Shelly Steckdose 1
define Balkonkraftwerk_Input MQTT2_DEVICE shellyswitch25_B8B14E
setuuid Balkonkraftwerk_Input 61b89822-f33f-ff84-ddd4-08715b1f1a9f27e6
attr Balkonkraftwerk_Input IODev MQTT_Server
attr Balkonkraftwerk_Input comment To get appropriate loadState values: Change the default limit "100" in readingList to your needs.
attr Balkonkraftwerk_Input devStateIcon {my $onl = ReadingsVal($name,"online","false") eq "false"?"10px-kreis-rot" : ReadingsVal($name,"new_fw","false") eq "true" ? "10px-kreis-gelb" : "10px-kreis-gruen";;;; my $cons = ReadingsVal($name,"relay_0_power","unknown");;;; my $total = ReadingsVal($name,"relay_0_kWh","unknown");;;; "<a href=\"http://".ReadingsVal($name,"ip","none")." \"target=\"_blank\">".FW_makeImage($onl)."</a> <a href=\"/fhem?cmd.dummy=set $name toggle&XHR=1\">".FW_makeImage($state)."</a><div>Aktuell: <b>$cons</b> W - Total: <b>$total</b> kWh</div>"}
attr Balkonkraftwerk_Input model shelly1_w_energy_measuring
attr Balkonkraftwerk_Input readingList shellies/shellyswitch25-B8B14E/relay/0:.* state\
  shellies/shellyswitch25-B8B14E/relay/0:.* relay0\
  shellies/shellyswitch25-B8B14E/input/0:.* input0\
  shellies/shellyswitch25-B8B14E/online:.* online\
  shellies/announce:.* { $EVENT =~ m,..id...shellyswitch25-B8B14E...mac.*, ? json2nameValue($EVENT) : return }\
  shellies/shellyswitch25-B8B14E/announce:.* { json2nameValue($EVENT) }\
  shellies/shellyswitch25-B8B14E/relay/0/power:.* relay_0_power\
  shellies/shellyswitch25-B8B14E/relay/0/power:.* { my $compare = $EVTPART0 < 100 ? "off":"on";; ReadingsVal($NAME,"loadState","off") ne $compare ? { 'loadState' => $compare } : return }\
  shellies/shellyswitch25-B8B14E/relay/0/energy:.* relay_0_energy\
  shellies/shellyswitch25-B8B14E/relay/0/energy:.* {'relay_0_kWh' => sprintf("%.2f",$EVENT/60/1000)}\
  shellies/shellyswitch25-B8B14E/overtemperature:.* overtemperature\
  shellies/shellyswitch25-B8B14E/temperature:.* temperature\
  shellies/shellyswitch25-B8B14E/temperature_f:.* temperature_f\
  shellies/shellyswitch25-B8B14E/longpush/0:.* longpush_0\
  shellies/shellyswitch25-B8B14E/input_event/0:.* { json2nameValue($EVENT) }\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/info:.* { json2nameValue($EVENT) }\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/temperature_status:.* temperature_status\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/voltage:.* voltage
attr Balkonkraftwerk_Input room MQTT Geräte
attr Balkonkraftwerk_Input setList off:noArg shellies/shellyswitch25-B8B14E/relay/0/command off\
  on:noArg shellies/shellyswitch25-B8B14E/relay/0/command on\
  x_update:noArg shellies/shellyswitch25-B8B14E/command update_fw\
  x_mqttcom shellies/shellyswitch25-B8B14E/command $EVTPART1
# Shelly Steckdose 2
define Balkonkraftwerk_Output MQTT2_DEVICE shellyswitch25_B8B14E
setuuid Balkonkraftwerk_Output 61b898f7-f33f-ff84-fd73-3aa42d2cc11f38a9
attr Balkonkraftwerk_Output IODev MQTT_Server
attr Balkonkraftwerk_Output comment Channel 2 for MQTT2_shellyswitch25_B8B14E
attr Balkonkraftwerk_Output devStateIcon {my $onl = ReadingsVal($name,"online","false") eq "false"?"10px-kreis-rot" : ReadingsVal($name,"new_fw","false") eq "true" ? "10px-kreis-gelb" : "10px-kreis-gruen";;;; my $cons = ReadingsVal($name,"relay_1_power","unknown");;;; my $total = ReadingsVal($name,"relay_1_kWh","unknown");;;; "<a href=\"http://".ReadingsVal($name,"ip","none")." \"target=\"_blank\">".FW_makeImage($onl)."</a> <a href=\"/fhem?cmd.dummy=set $name toggle&XHR=1\">".FW_makeImage($state)."</a><div>Aktuell: <b>$cons</b> W - Total: <b>$total</b> kWh</div>"}
attr Balkonkraftwerk_Output model shelly25_split
attr Balkonkraftwerk_Output readingList shellies/shellyswitch25-B8B14E/relay/1:.* state\
  shellies/shellyswitch25-B8B14E/relay/1:.* relay1\
  shellies/shellyswitch25-B8B14E/input/1:.* input1\
  shellies/shellyswitch25-B8B14E/online:.* online\
  shellies/announce:.* { $EVENT =~ m,..id...shellyswitch25-B8B14E...mac.*, ? json2nameValue($EVENT) : return }\
  shellies/shellyswitch25-B8B14E/announce:.* { json2nameValue($EVENT) }\
  shellies/shellyswitch25-B8B14E/relay/1/power:.* relay_1_power\
  shellies/shellyswitch25-B8B14E/relay/1/power:.* { my $compare = $EVTPART0 < 100 ? "off":"on";; ReadingsVal($NAME,"loadState","off") ne $compare ? { 'loadState' => $compare } : return }\
  shellies/shellyswitch25-B8B14E/relay/1/energy:.* relay_1_energy\
  shellies/shellyswitch25-B8B14E/relay/1/energy:.* {'relay_1_kWh' => sprintf("%.2f",$EVENT/60/1000)}\
  shellies/shellyswitch25-B8B14E/overtemperature:.* overtemperature\
  shellies/shellyswitch25-B8B14E/temperature:.* temperature\
  shellies/shellyswitch25-B8B14E/temperature_f:.* temperature_f\
  shellies/shellyswitch25-B8B14E/longpush/1:.* longpush_1\
  shellies/shellyswitch25-B8B14E/input_event/1:.* { json2nameValue($EVENT) }\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/info:.* { json2nameValue($EVENT) }\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/temperature_status:.* temperature_status\
shellyswitch25_B8B14E:shellies/shellyswitch25-B8B14E/voltage:.* voltage
attr Balkonkraftwerk_Output room MQTT Geräte
attr Balkonkraftwerk_Output setList off:noArg shellies/shellyswitch25-B8B14E/relay/1/command off\
  on:noArg shellies/shellyswitch25-B8B14E/relay/1/command on
# Shelly Logs
define FileLog_Balkonkraftwerk FileLog ./log/Balkonkraftwerk-%Y.log Balkonkraftwerk
setuuid FileLog_Balkonkraftwerk 61b89822-f33f-ff84-f97c-7541cc463bf06c84
attr FileLog_Balkonkraftwerk logtype text
attr FileLog_Balkonkraftwerk room MQTT Geräte
#Dummy für den erzeugten Solarstrom
define Solarstrom dummy
setuuid Solarstrom 61dafb08-f33f-26d3-073f-18ef2537a4984e95
attr Solarstrom readingList relay_0_power
attr Solarstrom room Shelly Dummy
attr Solarstrom setList relay_0_power:slider,0,10,1000
attr Solarstrom useSetExtensions 1
attr Solarstrom webCmd relay_0_power
#Dummy für die Infrarotheizung
define Infrarotheizung dummy
setuuid Infrarotheizung 61b9b969-f33f-ff84-2e95-e28b6da93288d746
attr Infrarotheizung room Shelly Dummy
attr Infrarotheizung setList on off
attr Infrarotheizung useSetExtensions 1
attr Infrarotheizung userReadings UeberhitzungsSchutz
attr Infrarotheizung webCmd on:off
#Dummy für den Warmwasserboiler
define Warmwasserboiler dummy
setuuid Warmwasserboiler 61daf409-f33f-26d3-6b29-a6fee13bb3bdf92a
attr Warmwasserboiler room Shelly Dummy
attr Warmwasserboiler setList on off
attr Warmwasserboiler useSetExtensions 1
attr Warmwasserboiler webCmd on:off
#Aktualisierungsintervall für das Balkendiagramm des erzeugten Stroms
define aktuellerStrom dummy
setuuid aktuellerStrom 61dda1e1-f33f-5845-9956-2bf34a59863ca9ec
define akt_Strom at +*00:01:00 {my $akt_Strom = ReadingsVal("Balkonkraftwerk_Input", "relay_0_power","");; fhem("set aktuellerStrom $akt_Strom")}
setuuid akt_Strom 61dda25e-f33f-5845-5e91-42c03c0fce10b2b5

# Infrarotheizung über 300 Watt einschalten, ansonsten ausschalten (Aktualisierungsintervall 5 Minuten)
# Zusätzlich Überhitzungsschutz: Nach 120 Minuten (7200) Betrieb soll die Heizung ausgeschalten werden und die Hilfsvariable auf aktiv gesetzt werden,
# Erst nach 15 min (900sec) soll der Schutz deaktiviert werden

#Variablen für die Benutzereingabe der Werte
define intervall dummy
setuuid intervall 61d857d5-f33f-5845-b16d-1ecab200701c20ae
attr intervall room Shelly Dummy
define wattnumber dummy
setuuid wattnumber 61d8583f-f33f-5845-ff20-2f6387e7c4543eed
attr wattnumber room Shelly Dummy
define heatMax dummy
setuuid heatMax 61d85866-f33f-5845-b9f5-83f472e11402e3ca
attr heatMax room Shelly Dummy
define overheating dummy
setuuid overheating 61d8587e-f33f-5845-11f8-2d5662b27939ab8f
attr overheating room Shelly Dummy
# Set Default Werte beim Neustart des Containers
define BalkonkraftwerkUeberhitzungsschutz_INITIALIZED notify global:INITIALIZED set intervall 00:05;;set wattnumber 300;;set heatMax 120;;set overheating 15
setuuid BalkonkraftwerkUeberhitzungsschutz_INITIALIZED 61e0989a-f33f-00dd-0e4f-1a5056c668abbb09
#Ein- und Ausschalten der Infrarotheizung inkl. Überhitzungsschutz
define aktualisieren at +*00:00:10 { if (ReadingsVal("Solarstrom","relay_0_power",0) <= Value("wattnumber")) {\
    fhem("set Infrarotheizung off")\
} elsif (ReadingsVal("Infrarotheizung","state","") eq "on" && ReadingsAge("Infrarotheizung","state",0) >= Value("heatMax") * 60) {\
    fhem("set Infrarotheizung off;; setreading Infrarotheizung UeberhitzungsSchutz aktiv")\
} elsif (ReadingsVal("Infrarotheizung","UeberhitzungsSchutz", "") eq "aktiv" && ReadingsAge("Infrarotheizung", "UeberhitzungsSchutz", "") >= Value("overheating") * 60) {\
    fhem("set Infrarotheizung on;; setreading Infrarotheizung UeberhitzungsSchutz inaktiv")\
} elsif (ReadingsVal("Infrarotheizung","state","") eq "off" && ReadingsVal("Infrarotheizung","UeberhitzungsSchutz", "") ne "aktiv") {\
    fhem("set Infrarotheizung on")\
}}
setuuid aktualisieren 61c9eb87-f33f-062f-4f92-e01d445610ec498a
attr aktualisieren room Shelly Dummy

#Warmwasserboiler zu einem bestimmten Zeitraum ein- und ausschalten
define bestimmterZeitraum DOIF ([[$SELF:P_begin:"(\d\d:\d\d)$","00:00"]] and [?$SELF:P_begin:"^(\d\d).(\d\d).(\d\d\d\d)":$3."-".($2*1)."-".($1*1)] eq "$year-$month-$mday" ) (set Warmwasserboiler on)\
DOELSEIF ([[$SELF:P_ende:"(\d\d:\d\d)$","00:00"]] and [?$SELF:P_ende:"^(\d\d).(\d\d).(\d\d\d\d)":$3."-".($2*1)."-".($1*1)] eq "$year-$month-$mday" or ["^global$:^MODIFIED $SELF$"] ) (set Warmwasserboiler off)
setuuid bestimmterZeitraum 61c4d850-f33f-26d3-45cb-300bfa26a804f1a7
attr bestimmterZeitraum alias Warmwasserboiler ein- und ausschalten
attr bestimmterZeitraum cmdState on|off
attr bestimmterZeitraum group Datumsbereich von HH:MM dd.mm.yyyy bis HH:MM dd.mm.yyyy
attr bestimmterZeitraum icon time_calendar
attr bestimmterZeitraum readingList P_begin P_ende
attr bestimmterZeitraum room Shelly Dummy
attr bestimmterZeitraum setList P_begin:datetime,theme:"default",step:5,inline:true P_ende:datetime,theme:"default",step:5,inline:true
attr bestimmterZeitraum webCmd P_begin:P_ende
attr bestimmterZeitraum widgetOverride setList:textField-long
#Steuerung des Warmwasserboiler mit einem NOTIFY
define NotifyONbestimmterZeitraum notify bestimmterZeitraum IF ([bestimmterZeitraum:state] eq "on") (set Warmwasserboiler on)
setuuid NotifyONbestimmterZeitraum 61e19612-f33f-26d3-a0b7-ec29f1d74500158a
# Set Default Werte bei Container Start
define Bestimmterzeitraum_INITIALIZED notify global:INITIALIZED setreading bestimmterZeitraum P_begin 26.01.2022 10:00;;setreading bestimmterZeitraum P_ende 26.01.2022 10:15
setuuid Bestimmterzeitraum_INITIALIZED 61e2de9a-f33f-6d3a-1592-2ae41e65f5ac0102
 
#Erstellung eines Wochenplans von verschiedenen Strompreisen
#Deklarierung der Variablen für die Benutzereingabe
define timetable dummy
setuuid timetable 61dda5b0-f33f-26d3-ae04-f3d6bfd1b4881daa
attr timetable readingList time1,time2,time3,time4,time5,time6,time7
attr timetable room Shelly Dummy
#Deklarierung der Hilfsvariablen in dem Wochenplan
define tarifplan dummy
setuuid tarifplan 61dda75d-f33f-26d3-6881-54a4ec778b0557ae
attr tarifplan readingList tarif1,tarif2,tarif3,tarif4,tarif5,tarif6,tarif7
attr tarifplan room Shelly Dummy
#Warmwasserboiler wochenplanGM (Günstig und Mittel Tarif)
define wochenplanGM WeekdayTimer Warmwasserboiler \
  !$we|{ReadingsVal("timetable","time1",0)}|tarif1 \
  !$we|{ReadingsVal("timetable","time2",0)}|tarif2 \
  !$we|{ReadingsVal("timetable","time3",0)}|tarif3 \
  !$we|{ReadingsVal("timetable","time4",0)}|tarif4 \
  !$we|{ReadingsVal("timetable","time5",0)}|tarif5 \
  !$we|{ReadingsVal("timetable","time6",0)}|tarif6 \
  $we|00:00|tarif7 IF ([wochenpanGM:nextValue] eq "tarif1" and ([tarifplan:tarif1] eq "günstigster" or [tarifplan:tarif1] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif2" and ([tarifplan:tarif2] eq "günstigster" or [tarifplan:tarif2] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif3" and ([tarifplan:tarif3] eq "günstigster" or [tarifplan:tarif3] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif4" and ([tarifplan:tarif4] eq "günstigster" or [tarifplan:tarif4] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif5" and ([tarifplan:tarif5] eq "günstigster" or [tarifplan:tarif5] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif6" and ([tarifplan:tarif6] eq "günstigster" or [tarifplan:tarif6] eq "mittlerer") or [wochenplanGM:nextValue] eq "tarif7" and ([tarifplan:tarif7] eq "günstigster" or [tarifplan:tarif7] eq "mittlerer")) (set Warmwasserboiler on) ELSE (set Warmwasserboiler off)
setuuid wochenplanGM 61cb9e6d-f33f-26d3-910b-ec571ffa19ac7216
attr wochenplanGM commandTemplate set $NAME  $EVENT
attr wochenplanGM disable 0
attr wochenplanGM room Shelly Dummy
#Warmwasserboiler wochenplanG (Günstig Tarif)
define wochenplanG WeekdayTimer Warmwasserboiler \
  !$we|{ReadingsVal("timetable","time1",0)}|tarif1 \
  !$we|{ReadingsVal("timetable","time2",0)}|tarif2 \
  !$we|{ReadingsVal("timetable","time3",0)}|tarif3 \
  !$we|{ReadingsVal("timetable","time4",0)}|tarif4 \
  !$we|{ReadingsVal("timetable","time5",0)}|tarif5 \
  !$we|{ReadingsVal("timetable","time6",0)}|tarif6 \
  $we|00:00|tarif7 IF (([wochenplanG:nextValue] eq "tarif1" and [tarifplan:tarif1] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif2" and [tarifplan:tarif2] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif3" and [tarifplan:tarif3] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif4" and [tarifplan:tarif4] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif5" and [tarifplan:tarif5] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif6" and [tarifplan:tarif6] eq "günstigster") or ([wochenplanG:nextValue] eq "tarif7" and [tarifplan:tarif7] eq "günstigster")) (set Warmwasserboiler on) ELSE (set Warmwasserboiler off)
setuuid wochenplanG 61dd7170-f33f-26d3-e19e-7c649fbe35e86fdd
attr wochenplanG commandTemplate set $NAME  $EVENT
attr wochenplanG disable 0
attr wochenplanG room Shelly Dummy
# Aktualisieren des Kalenders, wenn Zeiten geändert werden
define WochenplanTimeNotify notify timetable set wochenplanG,wochenplanGM enable
setuuid WochenplanTimeNotify 61ddaf3e-f33f-00dd-0c36-3653d6f3cd1e4a4f
attr WochenplanTimeNotify room Shelly Dummy
# Set Default Werte beim Neustart des Containers
define BalkonkraftwerkTarifplan_INITIALIZED notify global:INITIALIZED setreading tarifplan tarif1 günstigster;;setreading tarifplan tarif2 mittlerer;;setreading tarifplan tarif3 teuerster;;setreading tarifplan tarif4 mittlerer;;setreading tarifplan tarif5 teuerster;;setreading tarifplan tarif6 mittlerer;;setreading tarifplan tarif7 günstigster
setuuid BalkonkraftwerkTarifplan_INITIALIZED 61e08c67-f33f-00dd-144c-f3b2531e5fd74283
define BalkonkraftwerkZeitplan_INITIALIZED notify global:INITIALIZED setreading timetable time1 00:00;;setreading timetable time2 08:00;;setreading timetable time3 10:00;;setreading timetable time4 14:00;;setreading timetable time5 18:00;;setreading timetable time6 22:00;;setreading timetable time7 24:00
setuuid BalkonkraftwerkZeitplan_INITIALIZED 61e08e39-f33f-00dd-30d2-50f744a31422e650


#Warmwasserboiler mithilfe von Solarstrom einschalten
define warmwasserboilerWattmodus at +*00:05:00 { if (ReadingsVal("Solarstrom","relay_0_power",0) > Value("wattnumberWarmwasserboiler")) { fhem("set Warmwasserboiler on")} else { fhem("set Warmwasserboiler off")}}
setuuid warmwasserboilerWattmodus 61dc9fd2-f33f-26d3-4156-ec82b75ce28cf910
attr warmwasserboilerWattmodus room Shelly Dummy

#Sensor Hobbyraum mit ID: 035DD29D94C5
define Hobbyraum HTTPMOD https://www.data199.com/api/pv1/device/lastmeasurement 30
setuuid Hobbyraum 61d4383a-f33f-f15b-5f0e-6d9ff7f587eec015
attr Hobbyraum userattr requestData
attr Hobbyraum extractAllJSON 1
attr Hobbyraum requestData deviceids=035DD29D94C5
attr Hobbyraum room Shelly Dummy
attr Hobbyraum stateFormat Temperatur: temperature °C <br> Luftfeuchtigkeit: humidity % <br> Messung: timestamp
attr Hobbyraum userReadings temperature:devices_01_measurement_t1.* { ReadingsVal("Hobbyraum","devices_01_measurement_t1",0) }, \
  humidity:devices_01_measurement_h.* { ReadingsVal("Hobbyraum","devices_01_measurement_h",0) }, \
  timestamp:devices_01_measurement_ts.* { POSIX::strftime("%F %T", localtime(ReadingsVal("Hobbyraum","devices_01_measurement_ts",0))) }

#Grenzwerte für Zimmertemperatur und Luftfeuchtigkeit
define SensorHumidityMin dummy
setuuid SensorHumidityMin 61d4b365-f33f-26d3-6144-ecb5092893afff94
attr SensorHumidityMin room Shelly Dummy
define SensorHumidityMax dummy
setuuid SensorHumidityMax 61d4b370-f33f-26d3-438b-2ae9188786b0ea13
attr SensorHumidityMax room Shelly Dummy
define SensorTemperatureMin dummy
setuuid SensorTemperatureMin 61d4b39a-f33f-26d3-b68e-ac6f9df682a7a32b
attr SensorTemperatureMin room Shelly Dummy
define SensorTemperatureMax dummy
setuuid SensorTemperatureMax 61d4b3aa-f33f-26d3-ba73-7f61650f5b14d63f
attr SensorTemperatureMax room Shelly Dummy
# Set Default Werte beim Neustart des Containers
define BalkonkraftwerkZimmertemperatur_INITIALIZED notify global:INITIALIZED set SensorHumidityMin 70;;set SensorHumidityMax 76;;set SensorTemperatureMin 19;;set SensorTemperatureMax 22
setuuid BalkonkraftwerkZimmertemperatur_INITIALIZED 61e094b8-f33f-00dd-4608-052a5ebfd01940c0

#Infrarotheizung einschalten mithilfe von Temperatur- und Luftfeuchtigkeitswerten
define optimiertesHeizen notify Sensor.* { if(ReadingsVal("Hobbyraum","devices_01_measurement_h",0)>Value("SensorHumidityMax") or ReadingsVal("Hobbyraum","devices_01_measurement_t1",0)<Value("SensorTemperatureMin")){ fhem("set Infrarotheizung on") } elsif (ReadingsVal("Hobbyraum","devices_01_measurement_h",0)<Value("SensorHumidityMin") or ReadingsVal("Hobbyraum","devices_01_measurement_t1",0)>Value("SensorTemperatureMax")){ fhem("set Infrarotheizung off")} else { fhem("set Infrarotheizung off") }}
setuuid optimiertesHeizen 61d4be77-f33f-26d3-fb56-d24283042ffe82d9
attr optimiertesHeizen room Shelly Dummy

#Priorisierung - Deklarierung von Variablen für die Umsetzung der Priorisierung
define wattnumberWarmwasserboiler dummy
setuuid wattnumberWarmwasserboiler 61dc04f4-f33f-26d3-be72-dc07da059663cf8d
attr wattnumberWarmwasserboiler room Shelly Dummy
define wattnumberSum dummy
setuuid wattnumberSum 61dc0507-f33f-26d3-c0fe-7344cd8563a34b1e
attr wattnumberSum room Shelly Dummy
#Berechnung der Wattgrößen für die Priorisierung
define Wattgroessenberechnung at +*00:00:10 {my $wattnumber=Value("wattnumber");;my $wattnumberWarmwasserboiler=Value("wattnumberWarmwasserboiler");;my $wattnumberSum=$wattnumber+$wattnumberWarmwasserboiler;;fhem("set wattnumberSum $wattnumberSum");;}
setuuid Wattgroessenberechnung 61dc0567-f33f-26d3-cc94-8253167e1a9e342a
attr Wattgroessenberechnung room Shelly Dummy
#Formel für die Priorisierung dser Infrarotheizung (Prio1) und Warmwasserboiler (Prio2)
define Priorisierung notify Solarstrom:relay_0_power:.* { if(ReadingsVal("Solarstrom","relay_0_power",0) > Value("wattnumberSum")){ fhem("set Infrarotheizung on");;fhem("set Warmwasserboiler on");;} elsif (ReadingsVal("Solarstrom","relay_0_power",0) > Value("wattnumber")){ fhem("set Infrarotheizung on");;fhem("set Warmwasserboiler off");;} else { fhem("set Infrarotheizung off");;fhem("set Warmwasserboiler off");; }}
setuuid Priorisierung 61df54c7-f33f-26d3-f2e3-e8977d4c5f787e81
attr Priorisierung room Shelly Dummy
# Ausschalten der anderen Modi bei Aktivierung eines Modus
define NotifyWochenplanG notify wochenplanG IF ([wochenplanG:disable] eq "0") (setreading wochenplanGM disable 1, set Priorisierung inactive, set warmwasserboilerWattmodus inactive, set bestimmterZeitraum disable)
setuuid NotifyWochenplanG 61e06f84-f33f-26d3-89b5-d089189ae42003bd
attr NotifyWochenplanG room Shelly Dummy
define NotifyWochenplanGM notify wochenplanGM IF ([wochenplanGM:disable] eq "0") (setreading wochenplanG disable 1, set Priorisierung inactive, set warmwasserboilerWattmodus inactive, set bestimmterZeitraum disable)
setuuid NotifyWochenplanGM 61e07011-f33f-26d3-154e-315d1f9859c5d719
attr NotifyWochenplanGM room Shelly Dummy
define NotifyPriorisierung notify Priorisierung IF ([Priorisierung] eq "active") (setreading wochenplanG disable 1, setreading wochenplanGM disable 1 , set warmwasserboilerWattmodus inactive, set bestimmterZeitraum disable, set aktualisieren inactive, set optimiertesHeizen inactive)
setuuid NotifyPriorisierung 61e07115-f33f-26d3-15c3-10ccff599149eb0c
attr NotifyPriorisierung room Shelly Dummy
define NotifyWarmwasserboilerWattmodus notify warmwasserboilerWattmodus IF ([warmwasserboilerWattmodus] eq "active") (setreading wochenplanG disable 1, setreading wochenplanGM disable 1, set Priorisierung inactive, set bestimmterZeitraum disable)
setuuid NotifyWarmwasserboilerWattmodus 61e07e30-f33f-26d3-dc0d-8ebc7fbbc3b167ab
attr NotifyWarmwasserboilerWattmodus room Shelly Dummy
define NotifyBestimmterZeitraum notify bestimmterZeitraum IF ([bestimmterZeitraum] eq "initialize") (setreading wochenplanG disable 1, setreading wochenplanGM disable 1, set Priorisierung inactive, set warmwasserboilerWattmodus inactive)
setuuid NotifyBestimmterZeitraum 61e07e90-f33f-26d3-1508-4c2ab1511f8f4270
attr NotifyBestimmterZeitraum room Shelly Dummy
define NotifyOptimiertesHeizen notify optimiertesHeizen IF ([optimiertesHeizen] eq "active") (set Priorisierung inactive, set aktualisieren inactive)
setuuid NotifyOptimiertesHeizen 61e0825b-f33f-26d3-7c00-65cf4c998ac2c96a
attr NotifyOptimiertesHeizen room Shelly Dummy
define NotifyAktualisieren notify aktualisieren IF ([aktualisieren] ne "inactive") (set Priorisierung inactive, set optimiertesHeizen inactive)
setuuid NotifyAktualisieren 61e0848b-f33f-26d3-9f13-80f296fd32484df8
attr NotifyAktualisieren room Shelly Dummy
#Beim Ausschalten eines Modus werden die jeweiligen Geräte ausgeschalten
define NotifyOffWochenplanG notify wochenplanG IF ([wochenplanG:disable] eq "1") (set Warmwasserboiler off)
setuuid NotifyOffWochenplanG 61e08d31-f33f-26d3-060f-6d3de95e16da176c
attr NotifyOffWochenplanG room Shelly Dummy
define NotifyOffPriorisierung notify Priorisierung IF ([Priorisierung] eq "inactive") (set Warmwasserboiler off, set Infrarotheizung off)
setuuid NotifyOffPriorisierung 61e08ddd-f33f-26d3-5cc7-efecf883d23c4f12
attr NotifyOffPriorisierung room Shelly Dummy
define NotifyOffWochenplanGM notify wochenplanGM IF ([wochenplanGM:disable] eq "1") (set Warmwasserboiler off)
setuuid NotifyOffWochenplanGM 61e08eb7-f33f-26d3-0358-9bf963b59a4e85c4
attr NotifyOffWochenplanGM room Shelly Dummy
define NotifyOffWarmwasserboilerWattmodus notify warmwasserboilerWattmodus IF ([warmwasserboilerWattmodus] eq "inactive") (set Warmwasserboiler off)
setuuid NotifyOffWarmwasserboilerWattmodus 61e08f04-f33f-26d3-50de-aea20cf1c0737778
attr NotifyOffWarmwasserboilerWattmodus room Shelly Dummy
define NotifyOffbestimmerZeitraum notify bestimmterZeitraum IF ([bestimmterZeitraum] eq "disabled") (set Warmwasserboiler off)
setuuid NotifyOffbestimmerZeitraum 61e08f49-f33f-26d3-6eeb-4341285efc5b46fd
attr NotifyOffbestimmerZeitraum room Shelly Dummy
define NotifyOffAktualisieren notify aktualisieren IF ([aktualisieren] eq "inactive") (set Infrarotheizung off)
setuuid NotifyOffAktualisieren 61e08fb1-f33f-26d3-d09d-b05c0ca929d930eb
attr NotifyOffAktualisieren room Shelly Dummy
define NotifyOffOptimiertesHeizen notify optimiertesHeizen IF ([optimiertesHeizen] eq "inactive") (set Infrarotheizung off)
setuuid NotifyOffOptimiertesHeizen 61e08ff0-f33f-26d3-6c86-53decd043bfdc09f
attr NotifyOffOptimiertesHeizen room Shelly Dummy
#######################################################################
#####         ENDE          Balkonkraftwerk         ENDE          #####
#######################################################################

#######################################################################
#####         START       Zusatz Funktionen         START         #####
#######################################################################
# Wetteranzeige
# erzeugt den Proplanta-Datenabruf
define WetterProplanta PROPLANTA Stuttgart de
setuuid WetterProplanta 61cedee7-f33f-5845-17ab-4c785f5db4bc9068
attr WetterProplanta group Wettervorhersage (Proplanta)
attr WetterProplanta room Wettervorhersage

# erzeugt die Anzeige zum Datenabruf
define VorschauProplanta weblink htmlCode {PROPLANTA_Html("WetterProplanta")}
setuuid VorschauProplanta 61cedee7-f33f-5845-b56c-dc7d076622d47c86
attr VorschauProplanta group Wettervorhersage (Proplanta)
attr VorschauProplanta room Wettervorhersage

# Spritpreise
# Shell Tankstelle
define Tankstelle_Shell HTTPMOD http://www.clever-tanken.de/tankstelle_details/10007 600
setuuid Tankstelle_Shell 61dd2ddf-f33f-5845-ce22-efba450994faae21
attr Tankstelle_Shell userattr reading01Name reading01Regex reading02Name reading02Regex reading03Name reading03Regex reading07Name reading07Regex reading08Name reading08Regex reading09Name reading09Regex readingOExpr
attr Tankstelle_Shell enableControlSet 1
attr Tankstelle_Shell reading01Name Diesel
attr Tankstelle_Shell reading01Regex "price-type-name">Diesel<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Shell reading02Name SuperE5
attr Tankstelle_Shell reading02Regex "price-type-name">Super.E5<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Shell reading03Name SuperE10
attr Tankstelle_Shell reading03Regex "price-type-name">Super.E10<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Shell reading07Name street
attr Tankstelle_Shell reading07Regex "streetAddress">(.*)<
attr Tankstelle_Shell reading08Name zip
attr Tankstelle_Shell reading08Regex "http://schema.org/postalCode">(.*)<
attr Tankstelle_Shell reading09Name city
attr Tankstelle_Shell reading09Regex "http://schema.org/addressCountry">(.*)<
attr Tankstelle_Shell readingOExpr $val =~ s/<[\d\D]+>//;;$val
attr Tankstelle_Shell stateFormat E5: SuperE5, E10: SuperE10, D: Diesel
attr Tankstelle_Shell timeout 10
# Total Tankstelle
define Tankstelle_Total HTTPMOD http://www.clever-tanken.de/tankstelle_details/8384 600
setuuid Tankstelle_Total 61dd2ddf-f33f-5845-1049-d516111d0d932370
attr Tankstelle_Total userattr reading01Name reading01Regex reading02Name reading02Regex reading03Name reading03Regex reading05Name reading05Regex reading06Name reading06Regex reading07Name reading07Regex readingOExpr
attr Tankstelle_Total enableControlSet 1
attr Tankstelle_Total reading01Name Diesel
attr Tankstelle_Total reading01Regex "price-type-name">Diesel<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Total reading02Name SuperE5
attr Tankstelle_Total reading02Regex "price-type-name">Super.E5<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Total reading03Name SuperE10
attr Tankstelle_Total reading03Regex "price-type-name">Super.E10<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Total reading05Name street
attr Tankstelle_Total reading05Regex "streetAddress">(.*)<
attr Tankstelle_Total reading06Name zip
attr Tankstelle_Total reading06Regex "http://schema.org/postalCode">(.*)<
attr Tankstelle_Total reading07Name city
attr Tankstelle_Total reading07Regex "http://schema.org/addressCountry">(.*)<
attr Tankstelle_Total readingOExpr $val =~ s/<[\d\D]+>//;;$val
attr Tankstelle_Total stateFormat E5: SuperE5, E10: SuperE10, D: Diesel
attr Tankstelle_Total timeout 10
# Aral Tankstelle
define Tankstelle_Aral HTTPMOD http://www.clever-tanken.de/tankstelle_details/7941 600
setuuid Tankstelle_Aral 61dd2ddf-f33f-5845-aaad-c03a59acb2878c14
attr Tankstelle_Aral userattr reading01Name reading01Regex reading02Name reading02Regex reading03Name reading03Regex reading06Name reading06Regex reading07Name reading07Regex reading08Name reading08Regex readingOExpr
attr Tankstelle_Aral enableControlSet 1
attr Tankstelle_Aral reading01Name Diesel
attr Tankstelle_Aral reading01Regex "price-type-name">Diesel<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Aral reading02Name SuperE5
attr Tankstelle_Aral reading02Regex "price-type-name">Super.E5<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Aral reading03Name SuperE10
attr Tankstelle_Aral reading03Regex "price-type-name">Super.E10<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Aral reading06Name street
attr Tankstelle_Aral reading06Regex "streetAddress">(.*)<
attr Tankstelle_Aral reading07Name zip
attr Tankstelle_Aral reading07Regex "http://schema.org/postalCode">(.*)<
attr Tankstelle_Aral reading08Name city
attr Tankstelle_Aral reading08Regex "http://schema.org/addressCountry">(.*)<
attr Tankstelle_Aral readingOExpr $val =~ s/<[\d\D]+>//;;$val
attr Tankstelle_Aral stateFormat E5: SuperE5, E10: SuperE10, D: Diesel
attr Tankstelle_Aral timeout 10
# Esso Tankstelle
define Tankstelle_Esso HTTPMOD http://www.clever-tanken.de/tankstelle_details/10009 600
setuuid Tankstelle_Esso 61dd2ddf-f33f-5845-bc31-7cda846ccc842bfb
attr Tankstelle_Esso userattr reading01Name reading01Regex reading02Name reading02Regex reading03Name reading03Regex reading06Name reading06Regex reading07Name reading07Regex reading08Name reading08Regex readingOExpr
attr Tankstelle_Esso enableControlSet 1
attr Tankstelle_Esso reading01Name Diesel
attr Tankstelle_Esso reading01Regex "price-type-name">Diesel<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Esso reading02Name SuperE5
attr Tankstelle_Esso reading02Regex "price-type-name">Super.E5<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Esso reading03Name SuperE10
attr Tankstelle_Esso reading03Regex "price-type-name">Super.E10<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Esso reading06Name street
attr Tankstelle_Esso reading06Regex "streetAddress">(.*)<
attr Tankstelle_Esso reading07Name zip
attr Tankstelle_Esso reading07Regex "http://schema.org/postalCode">(.*)<
attr Tankstelle_Esso reading08Name city
attr Tankstelle_Esso reading08Regex "http://schema.org/addressCountry">(.*)<
attr Tankstelle_Esso readingOExpr $val =~ s/<[\d\D]+>//;;$val
attr Tankstelle_Esso stateFormat E5: SuperE5, E10: SuperE10, D: Diesel
attr Tankstelle_Esso timeout 10
# Agip Tankstelle
define Tankstelle_Agip HTTPMOD http://www.clever-tanken.de/tankstelle_details/9532 600
setuuid Tankstelle_Agip 61dd2ddf-f33f-5845-b64f-1b028cd46b735e6c
attr Tankstelle_Agip userattr reading01Name reading01Regex reading02Name reading02Regex reading03Name reading03Regex reading05Name reading05Regex reading06Name reading06Regex reading07Name reading07Regex readingOExpr
attr Tankstelle_Agip enableControlSet 1
attr Tankstelle_Agip reading01Name Diesel
attr Tankstelle_Agip reading01Regex "price-type-name">Diesel<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Agip reading02Name SuperE5
attr Tankstelle_Agip reading02Regex "price-type-name">Super.E5<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Agip reading03Name SuperE10
attr Tankstelle_Agip reading03Regex "price-type-name">Super.E10<[\S\s\r\n]*?"current-price-\d+">(\d.\d{2}<[\S\s\r\n]*?"suffix-price-\d">\d)
attr Tankstelle_Agip reading05Name street
attr Tankstelle_Agip reading05Regex "streetAddress">(.*)<
attr Tankstelle_Agip reading06Name zip
attr Tankstelle_Agip reading06Regex "http://schema.org/postalCode">(.*)<
attr Tankstelle_Agip reading07Name city
attr Tankstelle_Agip reading07Regex "http://schema.org/addressCountry">(.*)<
attr Tankstelle_Agip readingOExpr $val =~ s/<[\d\D]+>//;;$val
attr Tankstelle_Agip stateFormat E5: SuperE5, E10: SuperE10, D: Diesel
attr Tankstelle_Agip timeout 10

#Pollenflug
define Pollenflug HTTPMOD https://www.donnerwetter.de/pollenflug/stuttgart/DE24718.html 3600
setuuid Pollenflug 61dd2ddf-f33f-5845-4d72-edf2fc82f8827a7d
attr Pollenflug userattr enableControlSet reading01Name reading01Regex reading02Name reading02Regex reading04Name reading04Regex reading06Name reading06Regex reading15Name reading15Regex reading21Name reading21Regex reading31Name reading31Regex requestHeader1
attr Pollenflug group Pollenflug (Donnerwetter)
attr Pollenflug reading01Name Erle
attr Pollenflug reading01Regex (?s)Erle.*?poll([\d])
attr Pollenflug reading02Name Hasel
attr Pollenflug reading02Regex (?s)Hasel.*?poll([\d])
attr Pollenflug reading04Name Graeser
attr Pollenflug reading04Regex (?s)Gr.ser.*?poll([\d])
attr Pollenflug reading06Name Linde
attr Pollenflug reading06Regex (?s)Linde.*?poll([\d])
attr Pollenflug reading15Name Raps
attr Pollenflug reading15Regex (?s)Raps.*?poll([\d])
attr Pollenflug reading21Name Birke
attr Pollenflug reading21Regex (?s)Birke.*?poll([\d])
attr Pollenflug reading31Name Kiefer
attr Pollenflug reading31Regex (?s)Kiefer.*?poll([\d])
attr Pollenflug requestHeader1 User-Agent: Mozilla/5.0 (Windows NT 6.0)
attr Pollenflug room Wettervorhersage

#Webradio
define Radiosender dummy
setuuid Radiosender 61dd2ddf-f33f-5845-1408-c47a7b0abe862051

define Radio_volume dummy
setuuid Radio_volume 61dd2ddf-f33f-5845-e283-5e540ac184e85223

#Müllkalender
define MuelltonnenKalender Calendar ical file Stuttgart-Müll.ics
setuuid MuelltonnenKalender 61db179c-f33f-a6b3-9613-ca2eadfee77dfaa9
attr MuelltonnenKalender room Abfuhrkalender
define Muelltonnen ABFALL MuelltonnenKalender 3600
setuuid Muelltonnen 61dc5be7-f33f-a6b3-b870-72ef95fbd3bb8145
attr Muelltonnen calendarname_praefix 0
attr Muelltonnen date_style date
attr Muelltonnen delimiter_reading |
attr Muelltonnen delimiter_text_reading und
attr Muelltonnen room Abfuhrkalender
attr Muelltonnen stateFormat next_text in next_days Tag(en)
attr Muelltonnen weekday_mapping Sonntag Montag Dienstag Mittwoch Donnerstag Freitag Samstag

#######################################################################
#####         ENDE        Zusatz Funktionen         ENDE          #####
#######################################################################
